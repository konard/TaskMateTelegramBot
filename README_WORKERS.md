# –í–æ—Ä–∫–µ—Ä—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π TaskMate

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –≤–æ—Ä–∫–µ—Ä–æ–≤ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–∞–¥–∞—á –∏ —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤.

## –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä—ã

### 1. ‚úÖ –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- **Job**: `SendScheduledTasksJob`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
- **–§—É–Ω–∫—Ü–∏—è**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∫–æ–≥–¥–∞ –Ω–∞—Å—Ç—É–ø–∞–µ—Ç `appear_date`

### 2. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
- **Job**: `CheckOverdueTasksJob`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –∫–∞–∂–¥—ã–µ 10 –º–∏–Ω—É—Ç
- **–§—É–Ω–∫—Ü–∏—è**: –ù–∞—Ö–æ–¥–∏—Ç –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏ —É–≤–µ–¥–æ–º–ª—è–µ—Ç –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

### 3. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤
- **Job**: `CheckUpcomingDeadlinesJob`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç
- **–§—É–Ω–∫—Ü–∏—è**: –ù–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö –∑–∞ 1, 2 –∏ 4 —á–∞—Å–∞

### 4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–¥–∞—á –±–µ–∑ –æ—Ç–≤–µ—Ç–æ–≤
- **Job**: `CheckUnrespondedTasksJob`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- **–§—É–Ω–∫—Ü–∏—è**: –ù–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ –∑–∞–¥–∞—á–∞—Ö –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ 2, 6 –∏ 24 —á–∞—Å–∞

### 5. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á
- **Job**: `ProcessRecurringTasksJob`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç
- **–§—É–Ω–∫—Ü–∏—è**: –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—ã–µ —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á

### 6. ‚úÖ –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–≤–æ–¥–∫–∞ –¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- **Job**: `SendDailySummaryJob`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 20:00
- **–§—É–Ω–∫—Ü–∏—è**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–≤–æ–¥–∫—É –ø–æ –∑–∞–¥–∞—á–∞–º –∑–∞ –¥–µ–Ω—å

### 7. ‚úÖ –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã
- **Job**: `SendWeeklyReportJob`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –∫–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 09:00
- **–§—É–Ω–∫—Ü–∏—è**: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

### 8. ‚úÖ –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á
- **Job**: `ArchiveOldTasksJob`
- **–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ**: –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 02:00
- **–§—É–Ω–∫—Ü–∏—è**: –ê—Ä—Ö–∏–≤–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏

## –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: Supervisor (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é `/etc/supervisor/conf.d/taskmate-workers.conf`:

```ini
[program:taskmate-workers]
process_name=%(program_name)s_%(process_num)02d
command=php /path/to/your/project/artisan queue:work --queue=notifications --sleep=3 --tries=3 --max-time=3600
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
user=www-data
numprocs=2
redirect_stderr=true
stdout_logfile=/path/to/your/project/storage/logs/workers.log
stopwaitsecs=3600
```

–ó–∞–ø—É—Å–∫:
```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start taskmate-workers:*
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Systemd

–°–æ–∑–¥–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å `/etc/systemd/system/taskmate-workers.service`:

```ini
[Unit]
Description=TaskMate Queue Workers
After=network.target

[Service]
Type=simple
User=www-data
Group=www-data
Restart=always
ExecStart=/usr/bin/php /path/to/your/project/artisan queue:work --queue=notifications --sleep=3 --tries=3 --max-time=3600
WorkingDirectory=/path/to/your/project
StandardOutput=syslog
StandardError=syslog
SyslogIdentifier=taskmate-workers

[Install]
WantedBy=multi-user.target
```

–ó–∞–ø—É—Å–∫:
```bash
sudo systemctl daemon-reload
sudo systemctl enable taskmate-workers
sudo systemctl start taskmate-workers
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)

```bash
# –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤
php artisan queue:work --queue=notifications --sleep=3 --tries=3

# –ò–ª–∏ –≤ —Ñ–æ–Ω–µ
nohup php artisan queue:work --queue=notifications --sleep=3 --tries=3 > storage/logs/workers.log 2>&1 &
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤:

```bash
# –¢–µ—Å—Ç –≤—Å–µ—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤
php artisan workers:test

# –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
php artisan workers:test overdue

# –¢–µ—Å—Ç –ø—Ä–∏–±–ª–∏–∂–∞—é—â–∏—Ö—Å—è –¥–µ–¥–ª–∞–π–Ω–æ–≤
php artisan workers:test upcoming

# –¢–µ—Å—Ç –∑–∞–¥–∞—á –±–µ–∑ –æ—Ç–≤–µ—Ç–æ–≤
php artisan workers:test unresponded

# –¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
php artisan workers:test scheduled

# –¢–µ—Å—Ç –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á
php artisan workers:test recurring
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤:

```bash
# –õ–æ–≥–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤
tail -f storage/logs/laravel.log

# –ü–æ–∏—Å–∫ —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø–∏—Å–µ–π
grep "CheckOverdueTasksJob" storage/logs/laravel.log
grep "CheckUpcomingDeadlinesJob" storage/logs/laravel.log
grep "CheckUnrespondedTasksJob" storage/logs/laravel.log
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –æ—á–µ—Ä–µ–¥–∏:

```bash
# –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–¥–∞—á –≤ –æ—á–µ—Ä–µ–¥–∏
php artisan queue:monitor notifications

# –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–∏—Å—à–∏—Ö –∑–∞–¥–∞—á
php artisan queue:clear notifications

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ—É–¥–∞—á–Ω—ã—Ö –∑–∞–¥–∞—á
php artisan queue:retry all
```

### Supervisor –∫–æ–º–∞–Ω–¥—ã:

```bash
# –°—Ç–∞—Ç—É—Å –≤–æ—Ä–∫–µ—Ä–æ–≤
sudo supervisorctl status taskmate-workers:*

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤
sudo supervisorctl restart taskmate-workers:*

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo supervisorctl tail taskmate-workers
```

## –ß–∞—Å—Ç–æ—Ç–∞ —Ä–∞–±–æ—Ç—ã

| –í–æ—Ä–∫–µ—Ä | –ß–∞—Å—Ç–æ—Ç–∞ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|--------|--------|------------|
| `SendScheduledTasksJob` | 5 –º–∏–Ω—É—Ç | –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞—á |
| `CheckOverdueTasksJob` | 10 –º–∏–Ω—É—Ç | –ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ—Å—Ä–æ—á–µ–∫ |
| `CheckUpcomingDeadlinesJob` | 15 –º–∏–Ω—É—Ç | –°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è |
| `CheckUnrespondedTasksJob` | 30 –º–∏–Ω—É—Ç | –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ |
| `ProcessRecurringTasksJob` | 30 –º–∏–Ω—É—Ç | –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–¥–∞—á |
| `SendDailySummaryJob` | 20:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ | –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –æ—Ç—á–µ—Ç—ã |
| `SendWeeklyReportJob` | –ü–Ω 09:00 | –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã |
| `ArchiveOldTasksJob` | 02:00 –µ–∂–µ–¥–Ω–µ–≤–Ω–æ | –ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –∑–∞–¥–∞—á |

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - –ù–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
   - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –¥–µ–¥–ª–∞–π–Ω–∞—Ö (1—á, 2—á, 4—á –¥–æ)
   - –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ –∑–∞–¥–∞—á–∞—Ö –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ (2—á, 6—á, 24—á)
   - –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ (–¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)

2. **–ú–µ–Ω–µ–¥–∂–µ—Ä—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**:
   - –ü—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏
   - –ó–∞–¥–∞—á–∏ –±–µ–∑ –æ—Ç–≤–µ—Ç–∞ (>6—á, >24—á)
   - –ü—Ä–∏–±–ª–∏–∂–∞—é—â–∏–µ—Å—è –≤–∞–∂–Ω—ã–µ –¥–µ–¥–ª–∞–π–Ω—ã (1—á, 2—á)
   - –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ/–µ–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –æ—Ç—á–µ—Ç—ã

### –§–æ—Ä–º–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π:

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç Markdown —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –≤–∫–ª—é—á–∞—é—Ç:
- üìå –ó–∞–≥–æ–ª–æ–≤–æ–∫ –∑–∞–¥–∞—á–∏
- üìù –û–ø–∏—Å–∞–Ω–∏–µ (–µ—Å–ª–∏ –µ—Å—Ç—å)
- ‚è∞ –î–µ–¥–ª–∞–π–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)
- üë§ –ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏ (–¥–ª—è –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤)
- üéØ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ (OK, –í—ã–ø–æ–ª–Ω–µ–Ω–æ, –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏)

## –û—Ç–ª–∞–¥–∫–∞

### –í–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–ª–∞–¥–∫–∏:

```bash
# –í–∫–ª—é—á–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
php artisan config:clear
grep -i "workers\|jobs\|queue" storage/logs/laravel.log

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤ —Å –æ—Ç–ª–∞–¥–∫–æ–π
php artisan workers:test upcoming --verbose
```

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

1. **–í–æ—Ä–∫–µ—Ä—ã –Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ queue driver –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –æ—á–µ—Ä–µ–¥–∏ `notifications`

2. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –Ω–µ –ø—Ä–∏—Ö–æ–¥—è—Ç**:
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ `telegram_id` —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –±–æ—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ—à–∏–±–æ–∫

3. **–í–æ—Ä–∫–µ—Ä—ã –∑–∞–≤–∏—Å–∞—é—Ç**:
   - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –≤–æ—Ä–∫–µ—Ä—ã: `php artisan queue:restart`
   - –û—á–∏—Å—Ç–∏—Ç–µ –∑–∞–≤–∏—Å—à–∏–µ –∑–∞–¥–∞—á–∏: `php artisan queue:clear`